const https = require('https');
const express = require('express');

const app = express();

app.use((req, res, next) => {
    res.header('Content-Security-Policy', `default-src 'self'; script-src 'self' 'nonce-dQw4w9WgXcQ'; style-src 'self' 'nonce-dQw4w9WgXcQ'; connect-src https://json.extendsclass.com`);
    res.header('X-WAIT-Inclusion-Proofs', 'eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1cmwiOiJodHRwczovL2V4YW1wbGUuYXBwLyIsImhhc2giOiI0YmFkOWQ2NzVlM2Y0YzUwZjJhMzYzNjNhMTQ2NzZkZjMwYjk0NmRiNDM2ODdhMjg5ZjIwMmIwZjg1YWQyNDRhNWMwZDY5YjMyOWRlYjcyYjVkZTBkYjVhNTVjMGFjZDU5ZmM3N2E2YzU3Yzc4MGRhY2E3MTIyZTY1OTE2YTU4NCIsImlhdCI6MTYxNDk2NjAwN30.mdNOx-ncmM49_e8wBS0iAvqetPB6mnS7M9H469oQ_LNnJYASfdbEP-S1_D1khFFhAmLh0t7YSTMd6bC6FFGDKw');
    next();
});

app.use(express.static(process.env['APP'] || './example-app'));

const cert = String(Buffer.from(`
LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURhekNDQWxPZ0F3SUJBZ0lVSjQzbkl2aW1o
dG95cUdxOVpwakl6ZGltUGFjd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1JURUxNQWtHQTFVRUJoTUNR
VlV4RXpBUkJnTlZCQWdNQ2xOdmJXVXRVM1JoZEdVeElUQWZCZ05WQkFvTQpHRWx1ZEdWeWJtVjBJ
RmRwWkdkcGRITWdVSFI1SUV4MFpEQWVGdzB5TVRBek1EVXhOakV3TWpaYUZ3MHlNakF6Ck1EVXhO
akV3TWpaYU1FVXhDekFKQmdOVkJBWVRBa0ZWTVJNd0VRWURWUVFJREFwVGIyMWxMVk4wWVhSbE1T
RXcKSHdZRFZRUUtEQmhKYm5SbGNtNWxkQ0JYYVdSbmFYUnpJRkIwZVNCTWRHUXdnZ0VpTUEwR0NT
cUdTSWIzRFFFQgpBUVVBQTRJQkR3QXdnZ0VLQW9JQkFRQzF5ellVN2M4MVNIRm5wT3FhdjEzYnF1
a1ZWR1NHbGh4ZUpZSXF0cGtBCm0wKzBiVjBPbWE3VjlMTUNKNXRLOXBCOHNIalNKc3FvdThYTmIw
dkJDb3pvRGllQXdYblJGazFLcnFwVkdsQlEKNmRDZFpoQk1zaTFHcmRXRnVHSGhwWjUxRGJwdTVU
UUJtcDB1YmdZVDVkN1J2VHFXRGVRazErcEV4WG45ckFJMQpQS0Q3bDVmN21HWU1PYy90N0FUMjZT
MWtTcTFNL3RCaEZVUkFPM0VlbmN2VXNvMGxOSTV6bGJJKzBXVnQxSzRICnJLVStwemZzbnVQaEdI
Mk5PY01zeFV4Nm92MUNYc1NqWVZOL3hqWVVQN0NyK1dqWkpKZjJjaUsvcVQvb0lhd0MKNjRRVHlF
ZktkTVRLdE5mRkRGZ3JSZFJOMVRqRmNtUlUwZnFXTEw2MnZSa2hBZ01CQUFHalV6QlJNQjBHQTFV
ZApEZ1FXQkJTbTNsSkFFY3FaZ1duZG1FZ0duVHkrV3NQRnJEQWZCZ05WSFNNRUdEQVdnQlNtM2xK
QUVjcVpnV25kCm1FZ0duVHkrV3NQRnJEQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01BMEdDU3FHU0li
M0RRRUJDd1VBQTRJQkFRQUsKcExEOGJoQ3JYWXdMbFNGTzRIVTVjL2NNaUs2RFJaZXhMTnI3b0Jw
WDZxSFRnQW1EaUpNVVh2Rkl4alBxUFZXQgpsL29TK3lnUTNIUXJJNVhkU09XN0NjOTNGVkgwVGl3
NUc0TEhsL2swQlVJZDFETHNtd1RWV2JjT3RNVndyRXhhCmpVTzdWZVZyajNuWUxrV2JCa25UZ3Vo
ZU85VkNFNUpENW9hQkt3Z3djUWVxMC9TK2FHaWdGVjkveWZPSWNUU2kKcFo3aGFVLy9tWXFTUmRN
Y0c1UDFjdDd6YmR4Y21MS0R2TCtRQXgrYWVMb3ZQOFRmUVh4V0ljUHljNy90OGZMbwpaWVdPWlJ3
YUwyM0lnVGNyRmxvSFB1MUh0alljZ1l4cWRBS29PVkQ4TmprMVlYYUNYdURuOVlqUUZRa0VjVEwy
CnI0RFQwbklyYk1sbTdVN2I5MVVPCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K`, 'base64'));

const key = String(Buffer.from(`
LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZB
QVNDQktjd2dnU2pBZ0VBQW9JQkFRQzF5ellVN2M4MVNIRm4KcE9xYXYxM2JxdWtWVkdTR2xoeGVK
WUlxdHBrQW0wKzBiVjBPbWE3VjlMTUNKNXRLOXBCOHNIalNKc3FvdThYTgpiMHZCQ296b0RpZUF3
WG5SRmsxS3JxcFZHbEJRNmRDZFpoQk1zaTFHcmRXRnVHSGhwWjUxRGJwdTVUUUJtcDB1CmJnWVQ1
ZDdSdlRxV0RlUWsxK3BFeFhuOXJBSTFQS0Q3bDVmN21HWU1PYy90N0FUMjZTMWtTcTFNL3RCaEZV
UkEKTzNFZW5jdlVzbzBsTkk1emxiSSswV1Z0MUs0SHJLVStwemZzbnVQaEdIMk5PY01zeFV4Nm92
MUNYc1NqWVZOLwp4allVUDdDcitXalpKSmYyY2lLL3FUL29JYXdDNjRRVHlFZktkTVRLdE5mRkRG
Z3JSZFJOMVRqRmNtUlUwZnFXCkxMNjJ2UmtoQWdNQkFBRUNnZ0VBVjlkb08zYXBYOUt3VVdkam9R
Q0U1cWJQMTJtZTVWVlZRYnlZQi9HUlByVE4KTDU2RWo1Qjg1WTlHaSt6OVlaeUFObS9EQWJDU3pq
TmxJWjM4bWJ0eVdKSzJUY1d2Q2ZQZnh3MWM2cUE3WE0yTgo2dkF0UWhINlJLT3NmOStYRkVSRnE4
UEZhTjVCWWVFR3dDK1RxanV4amVFRWxRc0RTVFkzVWFHbUQ0ZjB6U205CkZvUnBYYldCcmJYTzcx
UVFNS1dYV3c2MEVPKzgwSXFTN3FEOEVYL01wYm1MNGVGSDBNcVZNdFF4OVRwVnF1bjYKYkQyZmpo
ZkwvRENXZXh5TEZFMlJOZXZtSC9YbVZwWm04a09HbTFoUVRqeU1KV3lsd3ZDdzludlNuNXhYTGxU
TQpTcW9hMkRSRWFLMHJQY3FEb1BtUE0yd29oZWN3VXpJNVNNQ2ZVdkhla1FLQmdRRFpvUUEvR1JG
K0MvbktZb3pNCkdGZGFXMnlrZXVKRHQwV2JhaG85aVpSbTAzWjV0M3Y3Z1VPV2pJb2M1M1B6TjBu
RUoyd2JUNzNqYk1DZW1VUjAKaWtzY1BuN1VUU01QR0o5TERHTHpUbE9NZHFXV3ZyT2RSa01Zbm9Q
c1VrRGMyd0MzOGJRaXF6S3lUcVAvVTlnRwoyNG9yZE54TW5OT0FvaUloMmZRT0pxNXZWUUtCZ1FE
VjJMMXNwRGxCVGZlSXY2ajhVRVpOYkUwMDAxZUdjY0xDCjhrL0d6bTFPR1NkdXBYdmxvM1QxZk14
OHRtMXlhUnM0QnBHejFqVnNkVitWK003NmtiQitVTWQxZmRLS1ZCUTYKWTVxTW1UR1FDYnNkMS91
LzlkdHZNQTMrcnJaL29wSFh2UG0wcjRLa3E1cVhjQ1cyM0R2T3hUUXAxUHdRc3Y5cwpRU3BuaU1P
S25RS0JnRXh3YzNDMk1tR3VmU2NyNUQ1UGttY0hVNnFXQ3VFei96dnVVWmNwdXJrL0x3N2pkcVhK
CktsODNyODhsTUtITjJwZ09MTGVQRTZoTTYzOEpZSFQ2bWhVcWtrdXBhRllHRlBVOFBZa3VDc1I4
YS83OXJvTGcKU2ZMY3dvT0FCSTVPVWZ0SjV6YUNJVVZsdjg2UHVZSDNISm5VNndmeDBZd041cVV6
TTdqQXQyWWRBb0dCQUpGSwpqQkMzVjBzK1hOTWxYUHZvMG9zaDdTYlovSnFVeWozSGdscFJ3RVFT
cFE3eEVrZklrZHVFcWk2Rmg4RDNGbzR2Ck1HbGVQYmZ0Mno2NjZHMm45S0V0NHdhNXNRVlk4TkZu
QVFkTHdqZloxSzhISXIyZW5qTmlFL0FZNWxlN3JabEYKaE9hMVpHN2JSTkpsV01wdndaYlB0NHhB
Yis0c240ditqbi8vbE5PbEFvR0FQQjVldkJzd09nUlJGd3VtTGM4ZgowUUc5RHJjbUkzSjdlRVJa
WDVCZW9acHFSN3dQQS9kalJRV2ZYOFdZc0VSSWNsQ0JadXkrMnhUcHZITDhBTFVTCjFNK2p1RThr
VFQ3TWkvc2N5SkJGZWxxWG8zSE1uaTBkMTlFTVJzTG1yNXUyeUJpNHdvTERsaW54YXVEMXRJU0wK
UFdvQkNGb095dmVBVWpySDhxd2FjYnM9Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K`, 'base64'));

const port = process.env['PORT'] || 3001;
const host = process.env['HOST'] || '127.0.0.1';

const server = https.createServer({ key, cert }, app);
server.listen(port, host, () => console.log(`listening on https://${host}:${port}/`));
